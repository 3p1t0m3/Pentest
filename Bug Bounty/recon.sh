#!/bin/bash	
# Original code from TheCyberMentor/Heath Adams
url=$1
if [ ! -d "$url" ];then
	mkdir $url
fi
if [ ! -d "$url/recon" ];then
	mkdir $url/recon
fi
#    if [ ! -d '$url/recon/eyewitness' ];then
#        mkdir $url/recon/eyewitness
#    fi
if [ ! -d "$url/recon/scans" ];then
	mkdir $url/recon/scans
fi
if [ ! -d "$url/recon/httprobe" ];then
	mkdir $url/recon/httprobe
fi
if [ ! -d "$url/recon/potential_takeovers" ];then
	mkdir $url/recon/potential_takeovers
fi
if [ ! -d "$url/recon/wayback" ];then
	mkdir $url/recon/wayback
fi
if [ ! -d "$url/recon/wayback/params" ];then
	mkdir $url/recon/wayback/params
fi
if [ ! -d "$url/recon/wayback/extensions" ];then
	mkdir $url/recon/wayback/extensions
fi
if [ ! -f "$url/recon/httprobe/alive.txt" ];then
	touch $url/recon/httprobe/alive.txt
fi
if [ ! -f "$url/recon/final.txt" ];then
	touch $url/recon/temp_final.txt
fi

echo "[+] Harvesting subdomains with assetfinder..."
~/go/bin/./assetfinder $url >> $url/recon/temp_assetfinder.txt
cat $url/recon/temp_assetfinder.txt | grep $url >> $url/recon/temp_final.txt
rm $url/recon/temp_assetfinder.txt

echo "[+] Double-checking for subdomains with amass..."
amass enum -d $url >> $url/recon/temp_amass.txt
cat $url/recon/temp_amass.txt >> $url/recon/temp_final.txt
rm $url/recon/temp_amass.txt

# Clean up Temporary Final.txt
sort -u $url/recon/temp_final.txt > final.txt

echo "[+] Probing for alive domains..."
cat $url/recon/final.txt | sort -u | httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443' >> $url/recon/httprobe/temp_httprobe.txt
sort -u $url/recon/httprobe/temp_httprobe.txt > $url/recon/httprobe/alive.txt
rm $url/recon/httprobe/temp_httprobe.txt

echo "[+] Checking for possible subdomain takeover..."

if [ ! -f "$url/recon/potential_takeovers/potential_takeovers.txt" ];then
	touch $url/recon/potential_takeovers/potential_takeovers.txt
fi

subjack -w $url/recon/final.txt -t 100 -timeout 30 -ssl -c ~/go/src/github.com/haccer/subjack/fingerprints.json -v 3 -o $url/recon/potential_takeovers/potential_takeovers.txt

